# 属性类和属性实例化功能实现计划

- [x] 1. 扩展数据结构和类型定义
  - 在 GridV3/shared/types.ts 中添加属性相关的类型定义
  - 扩展 ComponentGroupDataItem 和 ComponentData 接口
  - 定义 PropertyClass、PropertyInstance、PropertyType 等类型
  - _需求: 1.2, 1.3, 5.1, 5.2_

- [x] 2. 实现属性数据管理逻辑
  - [x] 2.1 扩展 useThemePackV3Data Hook
    - 在 useThemePackV3Data.ts 中添加属性类管理方法
    - 实现 createPropertyClass、updatePropertyClass、deletePropertyClass 方法
    - 实现属性类使用情况查询方法
    - _需求: 1.2, 2.1, 2.3, 5.1_

  - [x] 2.2 实现属性实例管理方法
    - 添加 createPropertyInstance、updatePropertyInstance、deletePropertyInstance 方法
    - 实现批量更新组件属性实例的方法
    - 添加数据一致性验证逻辑
    - _需求: 3.2, 4.2, 4.3, 5.2_

- [x] 3. 创建属性输入组件
  - [x] 3.1 实现 TextPropertyInput 组件
    - 创建文本属性输入组件
    - 添加输入验证和长度限制
    - 实现实时保存功能
    - _需求: 3.3, 4.2_

  - [x] 3.2 实现 BooleanPropertyInput 组件
    - 创建布尔属性开关组件
    - 使用 Switch 或 Checkbox 组件
    - 实现状态切换和保存
    - _需求: 3.4, 4.2_

  - [x] 3.3 实现 SelectPropertyInput 组件
    - 创建单选属性选择组件
    - 使用 Select 或 RadioGroup 组件
    - 支持动态选项配置
    - _需求: 3.5, 4.2_

- [x] 4. 实现属性类管理界面
  - [x] 4.1 创建 PropertyClassPanel 组件
    - 实现属性类设置面板的基础结构
    - 添加属性类列表显示
    - 实现面板的打开和关闭逻辑
    - _需求: 1.1, 2.1_

  - [x] 4.2 实现 PropertyClassForm 组件
    - 创建属性类创建/编辑表单
    - 实现属性类型选择和配置
    - 添加单选项选项的动态配置
    - 实现表单验证和提交逻辑
    - _需求: 1.2, 1.3, 1.4, 1.5, 2.2_

  - [x] 4.3 实现 PropertyClassList 组件
    - 显示属性类列表和基本信息
    - 添加编辑和删除操作按钮
    - 实现删除确认和使用情况警告
    - _需求: 2.1, 2.2, 2.3, 2.4_

- [x] 5. 实现属性实例管理界面
  - [x] 5.1 创建 PropertyInstanceDialog 组件
    - 实现属性实例编辑弹窗的基础结构
    - 添加弹窗的打开和关闭逻辑
    - 集成属性实例列表和创建功能
    - _需求: 3.1, 4.1_

  - [x] 5.2 实现 PropertyInstanceForm 组件
    - 创建属性实例创建/编辑表单
    - 根据属性类型动态渲染输入组件
    - 实现表单验证和提交逻辑
    - _需求: 3.2, 3.3, 3.4, 3.5, 4.2_

  - [x] 5.3 实现 PropertyInstanceList 组件
    - 显示组件的所有属性实例
    - 添加编辑和删除操作
    - 实现实例值的实时更新
    - _需求: 4.1, 4.2, 4.3_

- [x] 6. 扩展现有组件
  - [x] 6.1 扩展 GroupHeader 组件
    - 在删除按钮左边添加属性设置按钮
    - 实现属性设置面板的触发逻辑
    - 添加属性设置按钮的样式和交互
    - _需求: 1.1_

  - [x] 6.2 扩展 ComponentEditDropdown 组件
    - 在组件下拉菜单中添加"属性设置"选项
    - 实现属性实例编辑弹窗的触发逻辑
    - 添加菜单项的样式和图标
    - _需求: 3.1_

- [x] 7. 实现数据持久化和兼容性
  - [x] 7.1 更新数据保存逻辑
    - 修改 setComponentGroupData 和 setBlockGroupData 方法
    - 确保属性类数据正确保存到 Strapi
    - 实现属性实例数据的持久化
    - _需求: 5.1, 5.2_

  - [x] 7.2 实现数据加载和兼容性处理
    - 为现有数据添加默认的空属性数组
    - 实现数据结构的向后兼容性
    - 添加数据迁移和验证逻辑
    - _需求: 5.3, 5.4_

- [x] 8. 实现错误处理和用户体验优化
  - [x] 8.1 添加输入验证和错误提示
    - 实现属性类名称的唯一性验证
    - 添加属性值的格式验证
    - 实现友好的错误提示信息
    - _需求: 1.2, 2.2, 4.2_

  - [x] 8.2 实现数据一致性处理
    - 添加属性类删除时的使用情况检查
    - 实现属性类修改时的实例更新逻辑
    - 添加数据冲突的处理机制
    - _需求: 2.3, 2.4, 4.4_

- [ ]\* 9. 添加测试和文档
  - [ ]\* 9.1 编写单元测试
    - 为属性数据管理方法编写测试
    - 为属性输入组件编写测试
    - 为表单验证逻辑编写测试
    - _需求: 所有需求的测试覆盖_

  - [ ]\* 9.2 编写集成测试
    - 测试完整的属性类创建到使用流程
    - 测试数据一致性和错误处理
    - 测试性能和边界情况
    - _需求: 所有需求的集成测试_

- [ ]\* 10. 性能优化和代码重构
  - [ ]\* 10.1 优化渲染性能
    - 使用 React.memo 优化组件渲染
    - 实现属性数据的缓存机制
    - 优化大量属性时的性能表现
    - _需求: 性能优化_

  - [ ]\* 10.2 代码重构和优化
    - 重构重复的数据管理逻辑
    - 优化组件的可复用性
    - 添加 TypeScript 类型安全检查
    - _需求: 代码质量优化_
